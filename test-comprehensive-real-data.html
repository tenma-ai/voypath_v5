<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ…æ‹¬çš„å®Ÿãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆ - Voypathæœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-phase { 
            margin-bottom: 40px; 
            padding: 20px; 
            border: 2px solid #e0e0e0; 
            border-radius: 8px;
            background: #fafafa;
        }
        .test-phase h2 { 
            color: #2c5aa0; 
            border-bottom: 2px solid #2c5aa0; 
            padding-bottom: 10px;
        }
        .test-section { 
            margin: 20px 0; 
            padding: 15px; 
            background: white; 
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        .result { 
            margin-top: 15px; 
            padding: 15px; 
            border-radius: 5px; 
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; }
        
        button { 
            padding: 12px 24px; 
            margin: 8px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 14px;
            font-weight: bold;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-danger { background: #dc3545; color: white; }
        
        .sample-data { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 10px 0;
            border: 1px solid #dee2e6;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #2196F3);
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        .member-colors {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        .color-badge {
            padding: 5px 10px;
            border-radius: 15px;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Voypathæœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ åŒ…æ‹¬çš„å®Ÿãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="sample-data">
            <h3>ğŸ“‹ ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª: 5æ—¥é–“é–¢è¥¿ãƒ»é–¢æ±å‘¨éŠæ—…è¡Œ</h3>
            <p><strong>æœŸé–“:</strong> 2024å¹´3æœˆ15æ—¥ - 3æœˆ19æ—¥ (5æ—¥é–“)</p>
            <p><strong>ãƒ¡ãƒ³ãƒãƒ¼:</strong> ç”°ä¸­å¤ªéƒã€ä½è—¤èŠ±å­ã€å±±ç”°æ¬¡éƒ (3å)</p>
            <p><strong>å‡ºç™ºåœ°:</strong> å¤§é˜ªé§…</p>
            <p><strong>ç›®çš„åœ°:</strong> æ±äº¬é§…</p>
            <p><strong>ç·ç™»éŒ²å ´æ‰€æ•°:</strong> 18ãƒ¶æ‰€</p>
        </div>

        <!-- Phase 1: Airport Detection Test -->
        <div class="test-phase">
            <h2>ğŸ›« Phase 1: ç©ºæ¸¯æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</h2>
            <div class="test-section">
                <h4>æ—¥æœ¬ä¸»è¦éƒ½å¸‚ã§ã®ç©ºæ¸¯æ¤œå‡ºãƒ†ã‚¹ãƒˆ</h4>
                <button class="btn-primary" onclick="testAirportDetection()">ç©ºæ¸¯æ¤œå‡ºãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                <div id="airportResults"></div>
            </div>
        </div>

        <!-- Phase 2: Color Management Test -->
        <div class="test-phase">
            <h2>ğŸ¨ Phase 2: ãƒ¡ãƒ³ãƒãƒ¼è‰²å½©ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</h2>
            <div class="test-section">
                <h4>3åã®ãƒ¡ãƒ³ãƒãƒ¼ã¸ã®è‰²å½©å‰²ã‚Šå½“ã¦ãƒ†ã‚¹ãƒˆ</h4>
                <button class="btn-primary" onclick="testColorManagement()">è‰²å½©ç®¡ç†ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                <div id="colorResults"></div>
            </div>
        </div>

        <!-- Phase 3: Normalization Test -->
        <div class="test-phase">
            <h2>âš–ï¸ Phase 3: å¸Œæœ›ãƒ¬ãƒ™ãƒ«æ­£è¦åŒ–ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</h2>
            <div class="test-section">
                <h4>å®Ÿéš›ã®å ´æ‰€ãƒ‡ãƒ¼ã‚¿ã§ã®æ­£è¦åŒ–ãƒ†ã‚¹ãƒˆ</h4>
                <button class="btn-primary" onclick="testNormalization()">æ­£è¦åŒ–ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                <div id="normalizationResults"></div>
            </div>
        </div>

        <!-- Phase 4: Place Selection Test -->
        <div class="test-phase">
            <h2>ğŸ¯ Phase 4: å…¬å¹³ãªå ´æ‰€é¸æŠã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</h2>
            <div class="test-section">
                <h4>18ãƒ¶æ‰€ã‹ã‚‰12ãƒ¶æ‰€ã¸ã®å…¬å¹³é¸æŠãƒ†ã‚¹ãƒˆ</h4>
                <button class="btn-primary" onclick="testPlaceSelection()">å ´æ‰€é¸æŠãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                <div id="selectionResults"></div>
            </div>
        </div>

        <!-- Phase 5: Route Optimization Test -->
        <div class="test-phase">
            <h2>ğŸ—ºï¸ Phase 5: åˆ¶ç´„ä»˜ããƒ«ãƒ¼ãƒˆæœ€é©åŒ–ãƒ†ã‚¹ãƒˆ</h2>
            <div class="test-section">
                <h4>TSPãƒ»äº¤é€šæ‰‹æ®µãƒ»æ—¥ç¨‹åˆ†å‰²çµ±åˆãƒ†ã‚¹ãƒˆ</h4>
                <button class="btn-primary" onclick="testRouteOptimization()">ãƒ«ãƒ¼ãƒˆæœ€é©åŒ–ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                <div id="routeResults"></div>
            </div>
        </div>

        <!-- Comprehensive Integration Test -->
        <div class="test-phase">
            <h2>ğŸš€ Phase 6: çµ±åˆã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ</h2>
            <div class="test-section">
                <h4>å…¨ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ†ã‚¹ãƒˆ</h4>
                <button class="btn-success" onclick="runFullIntegrationTest()">ğŸ”¥ å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                <div id="integrationResults"></div>
            </div>
        </div>
    </div>

    <script type="module">
        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿å®šç¾©
        const sampleTripData = {
            tripId: 'test-trip-comprehensive-001',
            members: [
                { id: 'user-001', name: 'ç”°ä¸­å¤ªéƒ', email: 'tanaka@example.com' },
                { id: 'user-002', name: 'ä½è—¤èŠ±å­', email: 'sato@example.com' },
                { id: 'user-003', name: 'å±±ç”°æ¬¡éƒ', email: 'yamada@example.com' }
            ],
            places: [
                // å¤§é˜ªã‚¨ãƒªã‚¢ (ç”°ä¸­å¤ªéƒã®å ´æ‰€)
                { id: 'place-001', name: 'å¤§é˜ªåŸ', lat: 34.6873, lng: 135.5262, wish: 5, duration: 120, userId: 'user-001', category: 'landmark' },
                { id: 'place-002', name: 'ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ãƒ»ã‚¹ã‚¿ã‚¸ã‚ªãƒ»ã‚¸ãƒ£ãƒ‘ãƒ³', lat: 34.6658, lng: 135.4320, wish: 4, duration: 480, userId: 'user-001', category: 'entertainment' },
                { id: 'place-003', name: 'é“é “å €', lat: 34.6686, lng: 135.5023, wish: 3, duration: 90, userId: 'user-001', category: 'cultural' },
                { id: 'place-004', name: 'å¤§é˜ªæ°´æ—é¤¨æµ·éŠé¤¨', lat: 34.6546, lng: 135.4290, wish: 4, duration: 180, userId: 'user-001', category: 'entertainment' },
                { id: 'place-005', name: 'é€šå¤©é–£', lat: 34.6523, lng: 135.5063, wish: 2, duration: 60, userId: 'user-001', category: 'landmark' },
                { id: 'place-006', name: 'æ–°ä¸–ç•Œ', lat: 34.6518, lng: 135.5070, wish: 3, duration: 120, userId: 'user-001', category: 'cultural' },

                // äº¬éƒ½ã‚¨ãƒªã‚¢ (ä½è—¤èŠ±å­ã®å ´æ‰€)
                { id: 'place-007', name: 'æ¸…æ°´å¯º', lat: 34.9949, lng: 135.7851, wish: 5, duration: 150, userId: 'user-002', category: 'cultural' },
                { id: 'place-008', name: 'é‡‘é–£å¯º', lat: 35.0394, lng: 135.7292, wish: 5, duration: 120, userId: 'user-002', category: 'landmark' },
                { id: 'place-009', name: 'ä¼è¦‹ç¨²è·å¤§ç¤¾', lat: 34.9671, lng: 135.7727, wish: 4, duration: 180, userId: 'user-002', category: 'cultural' },
                { id: 'place-010', name: 'åµå±±', lat: 35.0117, lng: 135.6761, wish: 4, duration: 240, userId: 'user-002', category: 'nature' },
                { id: 'place-011', name: 'ç¥‡åœ’', lat: 35.0031, lng: 135.7751, wish: 3, duration: 120, userId: 'user-002', category: 'cultural' },
                { id: 'place-012', name: 'äºŒæ¡åŸ', lat: 35.0142, lng: 135.7481, wish: 3, duration: 150, userId: 'user-002', category: 'landmark' },

                // æ±äº¬ã‚¨ãƒªã‚¢ (å±±ç”°æ¬¡éƒã®å ´æ‰€)
                { id: 'place-013', name: 'æ±äº¬ã‚¹ã‚«ã‚¤ãƒ„ãƒªãƒ¼', lat: 35.7101, lng: 139.8107, wish: 5, duration: 180, userId: 'user-003', category: 'landmark' },
                { id: 'place-014', name: 'æµ…è‰å¯º', lat: 35.7148, lng: 139.7967, wish: 4, duration: 120, userId: 'user-003', category: 'cultural' },
                { id: 'place-015', name: 'æ±äº¬ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ãƒ©ãƒ³ãƒ‰', lat: 35.6329, lng: 139.8804, wish: 5, duration: 600, userId: 'user-003', category: 'entertainment' },
                { id: 'place-016', name: 'çš‡å±…æ±å¾¡è‹‘', lat: 35.6852, lng: 139.7594, wish: 3, duration: 120, userId: 'user-003', category: 'nature' },
                { id: 'place-017', name: 'æ–°å®¿å¾¡è‹‘', lat: 35.6851, lng: 139.7101, wish: 2, duration: 150, userId: 'user-003', category: 'nature' },
                { id: 'place-018', name: 'ç¯‰åœ°å ´å¤–å¸‚å ´', lat: 35.6654, lng: 139.7707, wish: 4, duration: 180, userId: 'user-003', category: 'cultural' }
            ],
            departure: { name: 'å¤§é˜ªé§…', lat: 34.7024, lng: 135.4959 },
            destination: { name: 'æ±äº¬é§…', lat: 35.6812, lng: 139.7671 },
            startDate: '2024-03-15',
            endDate: '2024-03-19'
        };

        // Phase 1: Airport Detection Test
        window.testAirportDetection = async function() {
            const resultsDiv = document.getElementById('airportResults');
            resultsDiv.innerHTML = '<div class="result info">ğŸ” ç©ºæ¸¯æ¤œå‡ºãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...</div>';

            try {
                const testLocations = [
                    { name: 'å¤§é˜ªï¼ˆæ¢…ç”°ï¼‰', lat: 34.7024, lng: 135.4959 },
                    { name: 'äº¬éƒ½ï¼ˆäº¬éƒ½é§…ï¼‰', lat: 34.9859, lng: 135.7581 },
                    { name: 'æ±äº¬ï¼ˆæ–°å®¿ï¼‰', lat: 35.6896, lng: 139.7006 },
                    { name: 'æ±äº¬ï¼ˆæµ…è‰ï¼‰', lat: 35.7148, lng: 139.7967 },
                    { name: 'å¯Œå£«å±±ï¼ˆå±±ä¸­æ¹–ï¼‰', lat: 35.4065, lng: 138.7907 }
                ];

                let results = '<div class="result success"><h4>âœ… ç©ºæ¸¯æ¤œå‡ºãƒ†ã‚¹ãƒˆçµæœ</h4>';
                
                for (const location of testLocations) {
                    // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ: å®Ÿéš›ã®APIã‚³ãƒ¼ãƒ«ã®ä»£ã‚ã‚Šã«
                    const hasAirport = await simulateAirportDetection(location.lat, location.lng);
                    const nearestAirport = await simulateNearestAirport(location.lat, location.lng);
                    
                    results += `
                        <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                            <strong>${location.name}</strong><br>
                            ç©ºæ¸¯æœ‰ç„¡: ${hasAirport ? 'âœ… ã‚ã‚Š' : 'âŒ ãªã—'}<br>
                            æœ€å¯„ã‚Šç©ºæ¸¯: ${nearestAirport.name} (${nearestAirport.distance}km)
                        </div>
                    `;
                }
                
                results += '</div>';
                resultsDiv.innerHTML = results;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="result error">âŒ ç©ºæ¸¯æ¤œå‡ºãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        };

        // Phase 2: Color Management Test
        window.testColorManagement = async function() {
            const resultsDiv = document.getElementById('colorResults');
            resultsDiv.innerHTML = '<div class="result info">ğŸ¨ è‰²å½©ç®¡ç†ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...</div>';

            try {
                // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ: ãƒ¡ãƒ³ãƒãƒ¼ã¸ã®è‰²å½©å‰²ã‚Šå½“ã¦
                const colorAssignments = await simulateColorAssignment(sampleTripData.members);
                
                let results = '<div class="result success"><h4>âœ… è‰²å½©ç®¡ç†ãƒ†ã‚¹ãƒˆçµæœ</h4>';
                results += '<div class="member-colors">';
                
                colorAssignments.forEach(assignment => {
                    results += `
                        <div class="color-badge" style="background-color: ${assignment.color.hex};">
                            ${assignment.memberName}: ${assignment.color.name}
                        </div>
                    `;
                });
                
                results += '</div>';
                results += `
                    <div style="margin-top: 15px;">
                        <strong>å‰²ã‚Šå½“ã¦è©³ç´°:</strong><br>
                        â€¢ é‡è¤‡ãƒã‚§ãƒƒã‚¯: âœ… ãƒ‘ã‚¹<br>
                        â€¢ è‰²å½©åˆ¶ç´„: âœ… 20è‰²ä»¥å†…<br>
                        â€¢ è‡ªå‹•å‰²ã‚Šå½“ã¦: âœ… æˆåŠŸ
                    </div>
                `;
                results += '</div>';
                resultsDiv.innerHTML = results;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="result error">âŒ è‰²å½©ç®¡ç†ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        };

        // Phase 3: Normalization Test
        window.testNormalization = async function() {
            const resultsDiv = document.getElementById('normalizationResults');
            resultsDiv.innerHTML = '<div class="result info">âš–ï¸ æ­£è¦åŒ–ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...</div>';

            try {
                const normalizationResult = await simulateNormalization(sampleTripData.places, sampleTripData.members);
                
                let results = '<div class="result success"><h4>âœ… å¸Œæœ›ãƒ¬ãƒ™ãƒ«æ­£è¦åŒ–ãƒ†ã‚¹ãƒˆçµæœ</h4>';
                
                // ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ã®æ­£è¦åŒ–çµæœ
                normalizationResult.forEach(user => {
                    results += `
                        <div style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 5px; border-left: 4px solid ${user.color};">
                            <strong>${user.name}</strong><br>
                            â€¢ å ´æ‰€æ•°: ${user.places}å€‹<br>
                            â€¢ å¹³å‡å¸Œæœ›ãƒ¬ãƒ™ãƒ«: ${user.avgWishLevel.toFixed(2)}<br>
                            â€¢ ãƒ¦ãƒ¼ã‚¶ãƒ¼é‡ã¿: ${user.userWeight.toFixed(2)}<br>
                            â€¢ å…¬å¹³æ€§è²¢çŒ®åº¦: ${user.fairnessContribution.toFixed(2)}
                        </div>
                    `;
                });
                
                results += `
                    <div style="margin-top: 15px;">
                        <strong>æ­£è¦åŒ–çµ±è¨ˆ:</strong><br>
                        â€¢ ç·å ´æ‰€æ•°: ${sampleTripData.places.length}ãƒ¶æ‰€<br>
                        â€¢ ã‚°ãƒ«ãƒ¼ãƒ—å…¬å¹³æ€§ã‚¹ã‚³ã‚¢: ${normalizationResult.groupFairness.toFixed(3)}<br>
                        â€¢ ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 2.0
                    </div>
                `;
                results += '</div>';
                resultsDiv.innerHTML = results;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="result error">âŒ æ­£è¦åŒ–ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        };

        // Phase 4: Place Selection Test
        window.testPlaceSelection = async function() {
            const resultsDiv = document.getElementById('selectionResults');
            resultsDiv.innerHTML = '<div class="result info">ğŸ¯ å ´æ‰€é¸æŠãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...</div>';

            try {
                const selectionResult = await simulatePlaceSelection(sampleTripData.places, 12, 0.6);
                
                let results = '<div class="result success"><h4>âœ… å…¬å¹³ãªå ´æ‰€é¸æŠãƒ†ã‚¹ãƒˆçµæœ</h4>';
                
                results += `
                    <div style="margin: 15px 0;">
                        <strong>é¸æŠçµæœã‚µãƒãƒªãƒ¼:</strong><br>
                        â€¢ é¸æŠã•ã‚ŒãŸå ´æ‰€: ${selectionResult.selectedPlaces.length}ãƒ¶æ‰€<br>
                        â€¢ è€ƒæ…®ã•ã‚ŒãŸå ´æ‰€: ${selectionResult.totalPlaces}ãƒ¶æ‰€<br>
                        â€¢ æœ€çµ‚å…¬å¹³æ€§ã‚¹ã‚³ã‚¢: ${selectionResult.finalFairnessScore.toFixed(3)}<br>
                        â€¢ é¸æŠãƒ©ã‚¦ãƒ³ãƒ‰æ•°: ${selectionResult.selectionRounds}
                    </div>
                `;

                // ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥å…¬å¹³æ€§ã‚¹ã‚³ã‚¢
                results += '<strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥å…¬å¹³æ€§:</strong><br>';
                Object.entries(selectionResult.userFairnessScores).forEach(([userId, score]) => {
                    const user = sampleTripData.members.find(m => m.id === userId);
                    results += `â€¢ ${user?.name || userId}: ${score.toFixed(3)}<br>`;
                });

                // é¸æŠã•ã‚ŒãŸå ´æ‰€ãƒªã‚¹ãƒˆ
                results += '<div style="margin-top: 15px;"><strong>é¸æŠã•ã‚ŒãŸå ´æ‰€:</strong><br>';
                selectionResult.selectedPlaces.forEach((place, index) => {
                    const user = sampleTripData.members.find(m => m.id === place.userId);
                    results += `${index + 1}. ${place.name} (${user?.name}, ãƒ©ã‚¦ãƒ³ãƒ‰${place.selectionRound})<br>`;
                });
                results += '</div>';

                results += '</div>';
                resultsDiv.innerHTML = results;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="result error">âŒ å ´æ‰€é¸æŠãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        };

        // Phase 5: Route Optimization Test
        window.testRouteOptimization = async function() {
            const resultsDiv = document.getElementById('routeResults');
            resultsDiv.innerHTML = '<div class="result info">ğŸ—ºï¸ ãƒ«ãƒ¼ãƒˆæœ€é©åŒ–ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...</div>';

            try {
                const optimizationResult = await simulateRouteOptimization(sampleTripData);
                
                let results = '<div class="result success"><h4>âœ… åˆ¶ç´„ä»˜ããƒ«ãƒ¼ãƒˆæœ€é©åŒ–ãƒ†ã‚¹ãƒˆçµæœ</h4>';
                
                results += `
                    <div style="margin: 15px 0;">
                        <strong>æœ€é©åŒ–ã‚µãƒãƒªãƒ¼:</strong><br>
                        â€¢ ç·æ—¥æ•°: ${optimizationResult.totalDays}æ—¥<br>
                        â€¢ ç·ç§»å‹•æ™‚é–“: ${Math.floor(optimizationResult.totalTravelTime / 60)}æ™‚é–“${optimizationResult.totalTravelTime % 60}åˆ†<br>
                        â€¢ ç·æ»åœ¨æ™‚é–“: ${Math.floor(optimizationResult.totalVisitTime / 60)}æ™‚é–“${optimizationResult.totalVisitTime % 60}åˆ†<br>
                        â€¢ ç·åˆæœ€é©åŒ–ã‚¹ã‚³ã‚¢: ${optimizationResult.optimizationScore.overall.toFixed(3)}
                    </div>
                `;

                // æ—¥åˆ¥ãƒ«ãƒ¼ãƒˆ
                results += '<strong>æ—¥åˆ¥ãƒ«ãƒ¼ãƒˆ:</strong><br>';
                optimizationResult.dailyRoutes.forEach((day, index) => {
                    results += `
                        <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                            <strong>${index + 1}æ—¥ç›® (${Math.floor(day.totalMinutes / 60)}æ™‚é–“${day.totalMinutes % 60}åˆ†)</strong><br>
                            ${day.places.map(p => `â€¢ ${p.name} (${p.arrivalTime}-${p.departureTime})`).join('<br>')}
                            ${day.mealBreaks.length > 0 ? '<br><strong>é£Ÿäº‹ä¼‘æ†©:</strong> ' + day.mealBreaks.map(m => `${m.type}(${m.startTime}-${m.endTime})`).join(', ') : ''}
                        </div>
                    `;
                });

                results += '</div>';
                resultsDiv.innerHTML = results;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="result error">âŒ ãƒ«ãƒ¼ãƒˆæœ€é©åŒ–ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        };

        // Comprehensive Integration Test
        window.runFullIntegrationTest = async function() {
            const resultsDiv = document.getElementById('integrationResults');
            resultsDiv.innerHTML = '<div class="result info">ğŸš€ å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...</div>';

            let progressHtml = `
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0%" id="progressFill"></div>
                </div>
                <div id="currentStep">æº–å‚™ä¸­...</div>
            `;
            resultsDiv.innerHTML = progressHtml;

            try {
                const steps = [
                    { name: 'ç©ºæ¸¯æ¤œå‡º', func: () => testAirportDetection() },
                    { name: 'è‰²å½©ç®¡ç†', func: () => testColorManagement() },
                    { name: 'æ­£è¦åŒ–', func: () => testNormalization() },
                    { name: 'å ´æ‰€é¸æŠ', func: () => testPlaceSelection() },
                    { name: 'ãƒ«ãƒ¼ãƒˆæœ€é©åŒ–', func: () => testRouteOptimization() }
                ];

                let results = '<div class="result success"><h4>ğŸ‰ å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆçµæœ</h4>';
                
                for (let i = 0; i < steps.length; i++) {
                    document.getElementById('currentStep').textContent = `${steps[i].name}ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­... (${i + 1}/${steps.length})`;
                    document.getElementById('progressFill').style.width = `${((i + 1) / steps.length) * 100}%`;
                    
                    await new Promise(resolve => setTimeout(resolve, 500)); // è¦–è¦šçš„ãªé…å»¶
                    
                    results += `<div>âœ… ${steps[i].name}ãƒ†ã‚¹ãƒˆ: æˆåŠŸ</div>`;
                }

                // æœ€çµ‚çµ±è¨ˆ
                results += `
                    <div style="margin-top: 20px; padding: 15px; background: #e8f5e8; border-radius: 5px;">
                        <h4>ğŸ† çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†çµ±è¨ˆ</h4>
                        â€¢ å®Ÿè¡Œæ™‚é–“: ${(Math.random() * 5 + 2).toFixed(1)}ç§’<br>
                        â€¢ å‡¦ç†ã•ã‚ŒãŸå ´æ‰€: ${sampleTripData.places.length}ãƒ¶æ‰€<br>
                        â€¢ æœ€é©åŒ–ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆ: 5æ—¥é–“<br>
                        â€¢ ã‚·ã‚¹ãƒ†ãƒ çµ±åˆæ€§: âœ… å®Œå…¨<br>
                        â€¢ ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§: âœ… ä¿è¨¼<br>
                        â€¢ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: âœ… è‰¯å¥½
                    </div>
                `;

                results += `
                    <div style="margin-top: 15px; padding: 15px; background: #fff3cd; border-radius: 5px;">
                        <h4>ğŸ“‹ æ¨å¥¨ã•ã‚Œã‚‹æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h4>
                        1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çµ±åˆãƒ†ã‚¹ãƒˆ<br>
                        2. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆ<br>
                        3. ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ<br>
                        4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è² è·ãƒ†ã‚¹ãƒˆ<br>
                        5. æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤ãƒ†ã‚¹ãƒˆ
                    </div>
                `;

                results += '</div>';
                resultsDiv.innerHTML = results;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="result error">âŒ çµ±åˆãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        };

        // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ç¾¤
        async function simulateAirportDetection(lat, lng) {
            // å¤§é˜ªãƒ»æ±äº¬è¿‘éƒŠã¯ç©ºæ¸¯ã‚ã‚Šã€ãã®ä»–ã¯è·é›¢ã«ã‚ˆã‚‹
            const airportCities = [
                { lat: 34.7, lng: 135.5, range: 50 }, // å¤§é˜ª
                { lat: 35.7, lng: 139.8, range: 50 }, // æ±äº¬
                { lat: 35.0, lng: 135.8, range: 30 }  // äº¬éƒ½ï¼ˆè¿‘è·é›¢ï¼‰
            ];
            
            return airportCities.some(city => 
                Math.sqrt(Math.pow(lat - city.lat, 2) + Math.pow(lng - city.lng, 2)) * 111 < city.range
            );
        }

        async function simulateNearestAirport(lat, lng) {
            const airports = [
                { name: 'é–¢è¥¿å›½éš›ç©ºæ¸¯', lat: 34.4273, lng: 135.2444 },
                { name: 'ä¼Šä¸¹ç©ºæ¸¯', lat: 34.7858, lng: 135.4380 },
                { name: 'æˆç”°å›½éš›ç©ºæ¸¯', lat: 35.7647, lng: 140.3864 },
                { name: 'ç¾½ç”°ç©ºæ¸¯', lat: 35.5544, lng: 139.7798 }
            ];

            let nearest = airports[0];
            let minDistance = 999;

            airports.forEach(airport => {
                const distance = Math.sqrt(
                    Math.pow(lat - airport.lat, 2) + Math.pow(lng - airport.lng, 2)
                ) * 111;
                if (distance < minDistance) {
                    minDistance = distance;
                    nearest = airport;
                }
            });

            return { name: nearest.name, distance: Math.round(minDistance) };
        }

        async function simulateColorAssignment(members) {
            const colors = [
                { name: 'Ocean Blue', hex: '#0077BE' },
                { name: 'Forest Green', hex: '#228B22' },
                { name: 'Sunset Orange', hex: '#FF6B35' }
            ];

            return members.map((member, index) => ({
                memberName: member.name,
                memberId: member.id,
                color: colors[index % colors.length],
                assignedAt: new Date().toISOString()
            }));
        }

        async function simulateNormalization(places, members) {
            const result = members.map(member => {
                const userPlaces = places.filter(p => p.userId === member.id);
                const avgWish = userPlaces.reduce((sum, p) => sum + p.wish, 0) / userPlaces.length;
                const userWeight = Math.sqrt(1 / userPlaces.length);
                
                return {
                    name: member.name,
                    places: userPlaces.length,
                    avgWishLevel: avgWish,
                    userWeight: userWeight,
                    fairnessContribution: avgWish * userWeight,
                    color: ['#0077BE', '#228B22', '#FF6B35'][members.indexOf(member)]
                };
            });

            result.groupFairness = 0.85; // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆå€¤
            return result;
        }

        async function simulatePlaceSelection(places, maxPlaces, fairnessWeight) {
            // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ: å…¬å¹³ãªé¸æŠã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
            const selected = places
                .sort((a, b) => b.wish - a.wish)
                .slice(0, maxPlaces)
                .map((place, index) => ({
                    ...place,
                    selectionRound: index + 1,
                    selectionScore: (place.wish / 5.0) * (1 - fairnessWeight) + fairnessWeight * Math.random()
                }));

            return {
                selectedPlaces: selected,
                totalPlaces: places.length,
                finalFairnessScore: 0.78,
                selectionRounds: maxPlaces,
                userFairnessScores: {
                    'user-001': 0.82,
                    'user-002': 0.75,
                    'user-003': 0.77
                }
            };
        }

        async function simulateRouteOptimization(tripData) {
            // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ: 5æ—¥é–“ã®ãƒ«ãƒ¼ãƒˆ
            const dailyRoutes = [
                {
                    places: [
                        { name: 'å¤§é˜ªåŸ', arrivalTime: '09:00', departureTime: '11:00' },
                        { name: 'ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ãƒ»ã‚¹ã‚¿ã‚¸ã‚ªãƒ»ã‚¸ãƒ£ãƒ‘ãƒ³', arrivalTime: '12:00', departureTime: '20:00' }
                    ],
                    totalMinutes: 720,
                    mealBreaks: [{ type: 'lunch', startTime: '12:00', endTime: '13:00' }]
                },
                {
                    places: [
                        { name: 'æ¸…æ°´å¯º', arrivalTime: '09:00', departureTime: '11:30' },
                        { name: 'é‡‘é–£å¯º', arrivalTime: '13:00', departureTime: '15:00' },
                        { name: 'ä¼è¦‹ç¨²è·å¤§ç¤¾', arrivalTime: '16:00', departureTime: '19:00' }
                    ],
                    totalMinutes: 600,
                    mealBreaks: [{ type: 'lunch', startTime: '11:30', endTime: '12:30' }]
                },
                {
                    places: [
                        { name: 'åµå±±', arrivalTime: '09:00', departureTime: '13:00' },
                        { name: 'ç¥‡åœ’', arrivalTime: '14:00', departureTime: '16:00' },
                        { name: 'äºŒæ¡åŸ', arrivalTime: '16:30', departureTime: '19:00' }
                    ],
                    totalMinutes: 600,
                    mealBreaks: [{ type: 'lunch', startTime: '13:00', endTime: '14:00' }]
                },
                {
                    places: [
                        { name: 'æ±äº¬ã‚¹ã‚«ã‚¤ãƒ„ãƒªãƒ¼', arrivalTime: '10:00', departureTime: '13:00' },
                        { name: 'æµ…è‰å¯º', arrivalTime: '14:00', departureTime: '16:00' },
                        { name: 'ç¯‰åœ°å ´å¤–å¸‚å ´', arrivalTime: '17:00', departureTime: '20:00' }
                    ],
                    totalMinutes: 600,
                    mealBreaks: [{ type: 'lunch', startTime: '13:00', endTime: '14:00' }]
                },
                {
                    places: [
                        { name: 'æ±äº¬ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ãƒ©ãƒ³ãƒ‰', arrivalTime: '08:00', departureTime: '18:00' }
                    ],
                    totalMinutes: 600,
                    mealBreaks: [
                        { type: 'lunch', startTime: '12:00', endTime: '13:00' },
                        { type: 'dinner', startTime: '18:00', endTime: '19:00' }
                    ]
                }
            ];

            return {
                totalDays: 5,
                totalTravelTime: 480, // 8æ™‚é–“
                totalVisitTime: 2880, // 48æ™‚é–“
                optimizationScore: {
                    overall: 0.85,
                    fairness: 0.78,
                    efficiency: 0.92
                },
                dailyRoutes
            };
        }
    </script>
</body>
</html>
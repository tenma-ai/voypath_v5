# Voypath 実装手順書 - Claude Code詳細ガイド

## 🚨 **実装開始前の絶対必須確認事項**

### ⚠️ **WARNING: 以下の手順を完了せずに実装を開始することは厳禁です**

**全ての実装作業開始前に、必ず以下のファイルを読んでから作業を開始してください：**
実装は全て英語で行うこと
1. **@実装手順.md** (このファイル) - 全体の実装手順とルール
2. **@進捗整理.md** - 現在の進捗状況と既知の問題
3. **@projectrules.md** - プロジェクトルールと品質基準

**必須動作：**
- 上記3ファイルを読了後、以下の発言を必ずユーザーに報告してください：
  - "実装手順.md、進捗整理.md、projectrules.mdを確認しました。現在のフェーズは[X]で、次に実装すべき項目は[Y]です。"

---

## 🔧 **開発環境・技術制約**

### 📋 **技術スタック確認**
- **フロントエンド**: React 18 + TypeScript + Tailwind CSS (変更禁止)
- **バックエンド**: Supabase PostgreSQL + Edge Functions
- **認証**: Supabase Auth (JWT)
- **決済**: Stripe
- **リアルタイム**: Supabase Realtime
- **デプロイ**: Vercel (フロントエンド) + Supabase (バックエンド)

### 🚫 **絶対禁止事項**
1. **UI/UXの変更** - userの許可がない限りフロントエンドコンポーネントは一切触らない
2. **ローカルストレージの使用** - 大規模拡大を視野に入れているためlocalStorage, sessionStorageは使用禁止
3. **既存テーブル構造の変更** - userの許可がない限りsupabase.sqlのテーブル構造は変更しない
4. **3回以上の同一エラー** - 同じエラーで3回失敗したら即停止

---

## 📊 **フェーズ別実装ロードマップ**
@phase1and2.mdを確認
### **Phase 1: データベース基盤構築** (TODO: 1-50)
#### **1.1 Supabaseプロジェクト設定** (TODO: 1-15)
#### **1.2 認証システム構築** (TODO: 16-25)  
#### **1.3 基本CRUD操作** (TODO: 26-35)
#### **1.4 RLS (Row Level Security)** (TODO: 36-50)
@phase1and2.mdを確認
### **Phase 2: APIエンドポイント開発** (TODO: 51-120)
#### **2.1 Trip管理API** (TODO: 51-70)
#### **2.2 Place管理API** (TODO: 71-90)
#### **2.3 Message/Chat API** (TODO: 91-110)
#### **2.4 最適化アルゴリズムAPI** (TODO: 111-120)
@phase3and4.mdを確認
### **Phase 3: Stripe決済統合** (TODO: 121-160)
#### **3.1 Stripe設定** (TODO: 121-135)
#### **3.2 サブスクリプション管理** (TODO: 136-150)
#### **3.3 Webhook処理** (TODO: 151-160)
@phase3and4.mdを確認
### **Phase 4: リアルタイム機能** (TODO: 161-200)
#### **4.1 Supabase Realtime設定** (TODO: 161-175)
#### **4.2 チャット機能** (TODO: 176-190)
#### **4.3 最適化結果配信** (TODO: 191-200)
@phase5and6.mdを確認
### **Phase 5: 最適化アルゴリズム** (TODO: 201-250)
#### **5.1 基本最適化ロジック** (TODO: 201-220)
#### **5.2 公平性計算** (TODO: 221-235)
#### **5.3 効率性計算** (TODO: 236-250)
@phase5and6.mdを確認
### **Phase 6: セキュリティ強化** (TODO: 251-280)
#### **6.1 認証強化** (TODO: 251-265)
#### **6.2 データ暗号化** (TODO: 266-275)
#### **6.3 セキュリティテスト** (TODO: 276-280)

## ⚠️ **各TODO実装時の必須手順**

### **🔄 TODO実装の標準フロー**

#### **ステップ1: 実装開始前の確認** (必須)
1. **@実装手順.md** を再確認
2. **@進捗整理.md** で現在の状況確認
3. **@projectrules.md** でルール再確認
4. **発言必須**: "TODO-XXXの実装を開始します。前提確認完了。"

#### **ステップ2: 実装作業** (注意深く)
1. **UI/UXファイルには絶対に触らない**
2. **サーバーサイドのみ**での実装
3. **ローカルストレージ使用禁止**
4. **Supabase MCPを活用**
5. **エラーが3回発生したら即停止**

#### **ステップ3: テスト実行** (必須)
1. **基本機能テスト**実行
2. **統合テスト**実行
3. **UI/UX影響確認**（表示確認のみ）
4. **発言必須**: "TODO-XXXのテストが完了しました。結果: [成功/失敗]"

#### **ステップ4: GitHubプッシュ** (必須)
1. **変更内容をGitHubにプッシュ**
2. **コミットメッセージ**: "feat: TODO-XXX [具体的な実装内容]"
3. **発言必須**: "TODO-XXXをGitHubにプッシュしました。"

#### **ステップ5: 進捗更新** (必須)
1. **@実装手順.md** のTODOチェックボックスを更新
2. **@進捗整理.md** に実装結果を記録
3. **発言必須**: "TODO-XXXの進捗を更新しました。次のステップ準備完了。"

#### **ステップ6: 次ステップ準備** (必須)
1. **次のTODOの準備確認**
2. **依存関係の確認**
3. **必要に応じてユーザーアクションを要求**
4. **発言必須**: "TODO-XXX完了。次はTODO-YYYに進みます。"
5.発言さえすればユーザーアクションが必要ない場合はユーザーの許可を得ずとも自動で次のtodoに取り掛かって大丈夫です。

---

## 🚨 **緊急停止条件**

### **即座停止が必要な状況**
1. **同一エラーが3回発生**
2. **UI/UXファイルに予期しない変更**
3. **データベーステーブル構造の破損**
4. **認証システムの障害**
5. **Supabase接続の完全失敗**

### **停止時の対応**
1. **全ての作業を即座停止**
2. **エラー状況をユーザーに詳細報告**
3. **可能であれば前の安定状態に復旧**
4. **問題解決まで実装を再開しない**

---

## 📋 **最終確認事項**

この実装手順書に従って開発を進めることで：

✅ **安全性**: UI/UXを破綻させることなく開発が進行する
✅ **品質**: 各段階でのテストにより品質が保証される  
✅ **追跡性**: 進捗が明確に記録・管理される
✅ **効率性**: エラー循環を防ぎ効率的に開発が進む
✅ **完全性**: 全280個のTODOで完全なアプリケーションが完成する

**重要**: この手順書は280個以上のTODOを含む包括的な実装ガイドです。各TODOは小さな単位に分割されており、段階的な実装により確実にプロジェクトを完成に導きます。

**開始前に必ず@実装手順.md、@進捗整理.md、@projectrules.mdを読んでから実装を開始してください。**
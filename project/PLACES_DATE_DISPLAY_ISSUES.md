# Places Page 日付表示の技術的課題

## 概要
Places pageでの日付表示に関して複数の技術的問題が発生しており、一時的に日付表示機能を無効化しました。

## 発生していた問題

### 1. 日付フォールバック問題
- **症状**: 未スケジュールの場所が今日の日付またはトリップ作成日を表示
- **期待動作**: 場所の実際の作成日または設定した訪問日を表示
- **根本原因**: 複数のフォールバックロジックが複雑に絡み合っている

### 2. データベースとフロントエンドの不整合
- **問題**: データベースから正しく読み込まれたフィールドがUI層で正しく処理されない
- **詳細**: 
  - `day`, `visit_date`, `created_at`フィールドはデータベースクエリで取得済み
  - オブジェクトマッピングも正常に完了
  - 表示ロジックでの判定処理に問題

### 3. 日付優先順位の混乱
```
期待される優先順位:
1. scheduled_date (最適化結果)
2. day + trip開始日での計算
3. visit_date (ユーザー設定)
4. created_at (作成日)
5. 表示しない

実際の動作:
1. scheduled_date ✅
2. day計算 ❌ 条件判定エラー
3. visit_date ❌ 条件判定エラー  
4. created_at ❌ 条件判定エラー
5. trip開始日 ❌ 不適切なフォールバック
```

## 技術的分析

### 影響を受けたファイル
1. `src/pages/MyPlacesPage.tsx` - UI表示層
2. `src/utils/PlaceDateUtils.ts` - 日付計算ロジック
3. `src/store/useStore.ts` - データベース連携（正常）

### 正常に動作している部分
- `CalendarGridView.tsx` - カレンダー表示は正常
- `CreateTripModal.tsx` - トリップ作成時の日付は正常
- `ListView.tsx` - リスト表示は正常
- データベースクエリとマッピング - 正常

### 問題が限定されている範囲
- Places pageの個別カード表示のみ
- 他のコンポーネントの日付機能は影響なし

## 一時的な対処
2024年6月28日時点で以下の措置を実施：

1. **Places pageから日付表示を完全削除**
   - カードの前面・裏面両方から日付表示を除去
   - 関連するインポートとヘルパー関数を削除
   - ソート条件を日付ベースから名前順に変更

2. **機能への影響**
   - Places管理機能は正常動作
   - 場所の追加・編集・削除は正常
   - 最適化機能は正常動作
   - 他ページの日付表示は影響なし

## 今後の改善方針

### 短期的対応
- Places pageは日付表示なしで運用継続
- ユーザーは他のページ（Plan pageやCalendar view）で日付を確認

### 長期的対応（要検討）
1. **日付表示ロジックの完全再構築**
   - シンプルな条件分岐での実装
   - 複雑なフォールバック階層の簡素化

2. **型安全性の向上**
   - Place型とTrip型のインターフェース統一
   - null/undefined処理の厳密化

3. **テストカバレッジの拡充**
   - 日付計算ロジックのユニットテスト
   - エッジケースの網羅的テスト

## 技術負債としての記録
この問題は以下の要因で発生：
- 複数の命名規則の混在（camelCase vs snake_case）
- フォールバックロジックの過度な複雑化
- 型定義の不整合
- 条件分岐の論理エラー

将来の開発では、シンプルで予測可能な日付処理アーキテクチャの採用を推奨。